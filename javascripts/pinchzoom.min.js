(function(){var a=function(d){var f=function(h,g){this.el=d(h);this.zoomFactor=1;this.lastScale=1;this.offset={x:0,y:0};this.options=d.extend({},this.defaults,g);this.setupMarkup();this.bindEvents();this.update();this.enable()},b=function(h,g){return h+g},e=function(h,g){return h>g-0.01&&h<g+0.01};f.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,animationInterval:5,maxZoom:4,minZoom:0.5,lockDragAxis:false,use2d:true,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap"},handleDragStart:function(g){this.el.trigger(this.options.dragStartEventName);this.stopAnimation();this.lastDragPosition=false;this.hasInteraction=true;this.handleDrag(g)},handleDrag:function(g){if(this.zoomFactor>1){var h=this.getTouches(g)[0];this.drag(h,this.lastDragPosition);this.offset=this.sanitizeOffset(this.offset);this.lastDragPosition=h}},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName);this.end()},handleZoomStart:function(g){this.el.trigger(this.options.zoomStartEventName);this.stopAnimation();this.lastScale=1;this.nthZoom=0;this.lastZoomCenter=false;this.hasInteraction=true},handleZoom:function(h,j){var g=this.getTouchCenter(this.getTouches(h)),i=j/this.lastScale;this.lastScale=j;this.nthZoom+=1;if(this.nthZoom>3){this.scale(i,g);this.drag(g,this.lastZoomCenter)}this.lastZoomCenter=g},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName);this.end()},handleDoubleTap:function(i){var g=this.getTouches(i)[0],h=this.zoomFactor>1?1:this.options.tapZoomFactor,j=this.zoomFactor,k=(function(l){this.scaleTo(j+l*(h-j),g)}).bind(this);if(this.hasInteraction){return}if(j>h){g=this.getCurrentZoomCenter()}this.animate(this.options.animationDuration,this.options.animationInterval,k,this.swing);this.el.trigger(this.options.doubleTapEventName)},sanitizeOffset:function(m){var l=(this.zoomFactor-1)*this.getContainerX(),k=(this.zoomFactor-1)*this.getContainerY(),j=Math.max(l,0),i=Math.max(k,0),h=Math.min(l,0),g=Math.min(k,0);return{x:Math.min(Math.max(m.x,h),j),y:Math.min(Math.max(m.y,g),i)}},scaleTo:function(h,g){this.scale(h/this.zoomFactor,g)},scale:function(h,g){h=this.scaleZoomFactor(h);this.addOffset({x:(h-1)*(g.x+this.offset.x),y:(h-1)*(g.y+this.offset.y)})},scaleZoomFactor:function(g){var h=this.zoomFactor;this.zoomFactor*=g;this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom));return this.zoomFactor/h},drag:function(g,h){if(h){if(this.options.lockDragAxis){if(Math.abs(g.x-h.x)>Math.abs(g.y-h.y)){this.addOffset({x:-(g.x-h.x),y:0})}else{this.addOffset({y:-(g.y-h.y),x:0})}}else{this.addOffset({y:-(g.y-h.y),x:-(g.x-h.x)})}}},getTouchCenter:function(g){return this.getVectorAvg(g)},getVectorAvg:function(g){return{x:g.map(function(h){return h.x}).reduce(b)/g.length,y:g.map(function(h){return h.y}).reduce(b)/g.length}},addOffset:function(g){this.offset={x:this.offset.x+g.x,y:this.offset.y+g.y}},sanitize:function(){if(this.zoomFactor<this.options.zoomOutFactor){this.zoomOutAnimation()}else{if(this.isInsaneOffset(this.offset)){this.sanitizeOffsetAnimation()}}},isInsaneOffset:function(h){var g=this.sanitizeOffset(h);return g.x!==h.x||g.y!==h.y},sanitizeOffsetAnimation:function(){var h=this.sanitizeOffset(this.offset),g={x:this.offset.x,y:this.offset.y},i=(function(j){this.offset.x=g.x+j*(h.x-g.x);this.offset.y=g.y+j*(h.y-g.y);this.update()}).bind(this);this.animate(this.options.animationDuration,this.options.animationInterval,i,this.swing)},zoomOutAnimation:function(){var i=this.zoomFactor,h=1,g=this.getCurrentZoomCenter(),j=(function(k){this.scaleTo(i+k*(h-i),g)}).bind(this);this.animate(this.options.animationDuration,this.options.animationInterval,j,this.swing)},updateAspectRatio:function(){this.setContainerY(this.getContainerX()/this.getAspectRatio())},getInitialZoomFactor:function(){return this.container[0].offsetWidth/this.el[0].offsetWidth},getAspectRatio:function(){return this.el[0].offsetWidth/this.el[0].offsetHeight},getCurrentZoomCenter:function(){var g=this.container[0].offsetWidth*this.zoomFactor,i=this.offset.x,l=g-i-this.container[0].offsetWidth,o=i/l,m=o*this.container[0].offsetWidth/(o+1),p=this.container[0].offsetHeight*this.zoomFactor,h=this.offset.y,j=p-h-this.container[0].offsetHeight,n=h/j,k=n*this.container[0].offsetHeight/(n+1);if(l===0){m=this.container[0].offsetWidth}if(j===0){k=this.container[0].offsetHeight}return{x:m,y:k}},canDrag:function(){return !e(this.zoomFactor,1)},getTouches:function(h){var g=this.container.offset();return Array.prototype.slice.call(h.touches).map(function(i){return{x:i.pageX-g.left,y:i.pageY-g.top}})},animate:function(i,g,m,l,k){var h=new Date().getTime(),j=(function(){if(!this.inAnimation){return}var o=new Date().getTime()-h,n=o/i;if(o>=i){m(1);if(k){k()}this.update();this.stopAnimation();this.update()}else{if(l){n=l(n)}m(n);this.update();setTimeout(j,g)}}).bind(this);this.inAnimation=true;j()},stopAnimation:function(){this.inAnimation=false},swing:function(g){return -Math.cos(g*Math.PI)/2+0.5},getContainerX:function(){return this.container[0].offsetWidth},getContainerY:function(){return this.container[0].offsetHeight},setContainerY:function(g){return this.container.height(g)},setupMarkup:function(){this.container=d('<div class="pinch-zoom-container"></div>');this.el.before(this.container);this.container.append(this.el);this.container.css({overflow:"hidden",position:"relative"});this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"absolute"})},end:function(){this.hasInteraction=false;this.sanitize();this.update()},bindEvents:function(){c(this.container.get(0),this);d(window).on("resize",this.update.bind(this));d(this.el).find("img").on("load",this.update.bind(this))},update:function(){if(this.updatePlaned){return}this.updatePlaned=true;setTimeout((function(){this.updatePlaned=false;this.updateAspectRatio();var k=this.getInitialZoomFactor()*this.zoomFactor,h=-this.offset.x/k,l=-this.offset.y/k,j="scale3d("+k+", "+k+",1) translate3d("+h+"px,"+l+"px,0px)",g="scale("+k+", "+k+") translate("+h+"px,"+l+"px)",i=(function(){if(this.clone){this.clone.remove();delete this.clone}}).bind(this);if(!this.options.use2d||this.hasInteraction||this.inAnimation){this.is3d=true;i();this.el.css({"-webkit-transform":j,"-o-transform":g,"-ms-transform":g,"-moz-transform":g,transform:j})}else{if(this.is3d){this.clone=this.el.clone();this.clone.css("pointer-events","none");this.clone.appendTo(this.container);setTimeout(i,200)}this.el.css({"-webkit-transform":g,"-o-transform":g,"-ms-transform":g,"-moz-transform":g,transform:g});this.is3d=false}}).bind(this),0)},enable:function(){this.enabled=true},disable:function(){this.enabled=false}};var c=function(h,p){var r=null,k=0,i=null,t=null,n=function(u,v){if(r!==u){if(r&&!u){switch(r){case"zoom":p.handleZoomEnd(v);break;case"drag":p.handleDragEnd(v);break}}switch(u){case"zoom":p.handleZoomStart(v);break;case"drag":p.handleDragStart(v);break}}r=u},m=function(u){if(k===2){n("zoom")}else{if(k===1&&p.canDrag()){n("drag",u)}else{n(null,u)}}},q=function(u){return Array.prototype.slice.call(u).map(function(v){return{x:v.pageX,y:v.pageY}})},l=function(w,v){var u,z;u=w.x-v.x;z=w.y-v.y;return Math.sqrt(u*u+z*z)},j=function(x,w){var u=l(x[0],x[1]),v=l(w[0],w[1]);return v/u},o=function(u){u.stopPropagation();u.preventDefault()},s=function(u){var v=(new Date()).getTime();if(k>1){i=null}if(v-i<300){o(u);p.handleDoubleTap(u);switch(r){case"zoom":p.handleZoomEnd(u);break;case"drag":p.handleDragEnd(u);break}}if(k===1){i=v}},g=true;h.addEventListener("touchstart",function(u){if(p.enabled){g=true;k=u.touches.length;s(u)}});h.addEventListener("touchmove",function(u){if(p.enabled){if(g){m(u);if(r){o(u)}t=q(u.touches)}else{switch(r){case"zoom":p.handleZoom(u,j(t,q(u.touches)));break;case"drag":p.handleDrag(u);break}if(r){o(u);p.update()}}g=false}});h.addEventListener("touchend",function(u){if(p.enabled){k=u.touches.length;m(u)}})};return f};if(typeof define!=="undefined"&&define.amd){define(["jquery"],function(b){return a(b)})}else{window.RTP=window.RTP||{};window.RTP.PinchZoom=a(window.$)}}).call(this);